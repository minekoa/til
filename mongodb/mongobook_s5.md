# 第5章 どんな時 MongoDB を利用するか


ユースケース: ロギング

* 送信した書き込み命令は実際の書き込み完了を待たず即座に戻ってくるオプションがある
* データの耐久性に関する動作を制御できる
  * これらの設定は何台のサーバーに書き込んだら成功とするかを設定することで書き込み性能と耐久性を絶妙にコントロール出来ます
* スキーマレス
* cappedコレクションがある

```
// この Capped コレクションを 1Mbyte で制限します
db.createCollection('logs', {capped: true, size: 1048576})
```

> Capped コレクションが 1MByte の上限に達すると、古いドキュメントは自動的に削除
> されます。max オプションを指定することでドキュメントのサイズではなく数で制限でき
> ます。


## 5.5 トランザクション

ない。

1. ライトな方法

findAndModify はある
$inc や$set などの演算子と findAndModify　コマンド

2. 手動でトランザクションを実装する

> 実際のドキュメントの中にトランザクションの状態を格納し、
> init-pending-commit/rollback の段階を手動で行います。
> MongoDB がサポートしている入れ子のドキュメントとスキーマレスな設計は二層コ
> ミットの痛みを少し和らげます

## 5.6 データ処理

* 前の MongoDB はデータ処理の殆どの仕事を MapReduce に頼っていました。
* アグリゲーション・フレームワークやパイプラインと呼ばれる強力な機能が追加されました

名前だけご紹介。
とりあえず、次の章で理解しよう。

## 5.7 位置情報

> 非常に強力な機能として MongoDB は位置情報インデックスをサポートしています。
> geoJSON または x と y の座標をドキュメントに格納し、$near で指定した座標で検索し
> たり、$within で指定した四角や円で検索を行えます。

ほほー。
