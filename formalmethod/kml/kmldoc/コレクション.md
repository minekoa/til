# コレクション

set, list, mapがある。
VDMの文法を借用している。(ただし、`in set` が `in` に変化している)

http://research.nii.ac.jp/~f-ishikawa/vdm/files/VDM-LangReference.pdf

形式仕様記述言語であるため、プログラミング言語の感覚だと
若干違和感を覚えると思われる。慣れよ。


### 集合型

型:

```
Set 'a
```


値:

```
{1, 2, 3} , {'a', 'b', 'c'} ...
```

内包表記:

集合の値からの導出は

```
{ exp | p1 in hoge, p2 in piyo, ... & cond }
```

型からの導出は

```
{ exp | p1 : TypeName, p2 : TypeName, ... & cond }
```

`in` で ∈ と理解すると良い。

整数 m 以上で 整数 n以下である整数を全て含む集合:

```
{m, ..., n}
```

その他集合演算子

```
e in s
    例) 3 in set {1, 2, 3}
    結果) True
e not in s
    例) 3 not in {1, 2, 3}
    結果) False
s1 union s2
    例) {1, 2, 3} union {2, 4}
    結果) {1, 2, 3, 4}
s1 inter s2
    例) {1, 2, 3} inter {2, 4}
    結果) {2}
s1 \ s2
    例) {1, 2, 3} \ {2, 4}
    結果) {1, 3}
s1 subset s2
    例) {2, 3} subset {1,2,3}
    結果) True
    例) {2, 3} subset {2, 3}
    結果) True
s1 psubset s2
    例) {2, 3} psubset {2, 3}
    結果) False
card s
    例) card {2, 5, 6}
    結果) 3
dunion ss
    例) dunion { {1,2,3}
               , {2,4}
               ,{1,2,5}
               }
    結果) {1,2,3,4,5}
dinter ss
power s
```

### 列型

型:

```
List `a
```

値:

```
[1, 2, 3]，['a', 'c', 'x']，[ ]
```

内包的定義:

```
[ exp | pat1a, pat1b, ... in set s1, pat2a, pat2b, ... in set s2, ...
      & cond ]
```
※順序がわからないので型での束縛は不能

その他列演算子:

```
l # i
   例) ['a','b','c'] #2
   結果) 'b'
hd l
   例) hd [1,2,3]
   結果) 1
tl l
   例) tl [1,2,3]
   結果) [2,3]
e :: l
   例) 'a' :: ['b', 'c']
   結果) ['a', 'b', 'c']
len l
   例) len [1,2,3]
   結果) 3
elems l
   要素の集合を得る
   例) elems [1,2,3,2,3]
   結果) {1,2,3}
inds l
   インデックスの集合を得る
   例) inds [1,2,3,2,3]
   結果) {1,2,3,4,5}
l1 ˆl2
   l1 と l2 を連結
   例) [1,2] ˆ [3,2]
   結果) [1,2,3,2]
conc ll
   列の列 ll に含まれる列をすべて連結した列
   例) conc [[1,2],[3,2],[4,1]]
   結果) [1,2,3,2,4,1]
l ++ m
   インデックスで指定した要素を置き換え
   例) ['a','b','c','d'] ++ {1|->'x',4|->'y'}
   結果) ['x','b', 'c', 'y']
```

### 写像型

型:

```
Map 'a
```


値:

```
{1 |-> True, 2 |-> False, 3 |-> True}

{'A' |-> "41", 'B' |-> "42"}

{ |-> }
```

内包的定義:

```
{ e1 |-> e2 | pat1a, pat1b, ... in set s1, pat2a, ... in set s2, ...
            & cond }
```

一応型による束縛もできるが実行できない。

```
m(d)
   m のキー d に対応する値
   例) {1|->'a',2|->'b'}(2)
   結果) 'b'
dom m
   m の定義域（キーの集合）
   例) dom {1|->'a',2|->'b'}
   結果) {1,2}
rng m
   m の値域（対応づけられる値の集合）
   例) rng {1|->'a',2|->'b'}
   結果) {'a','b'}
inverse m
   m のキーと値を逆にした写像（m は inmap）
   例) inverse {1|->'a',
                2|->'b'}
   結果)       {'a'|->1,
                'b'|->2}


s <: m
   m の関連づけのうちキーがs に含まれるもののみ抜き出した写像
   例) {1,2} <: {1|->'a',
                 2|->'b',
                 3|->'c'}
   結果) {1|->'a',
          2|->'b'}
s <-: m
   m の関連づけのうちキーがs に含まれないもののみ抜き出した写像
   例) {1,2} <-: {1|->'a',
                  2|->'b',
                  3|->'c'}
   結果) {3|->'c'}
m :> s
   m の関連づけのうち値が sに含まれるもののみ抜き出した写像
   例) {1|->'a',2|->'b',3|->'c'} :> {'a','b'}
   結果) {1|->'a',2|->'b'}
m :-> s
   m の関連づけのうち値が sに含まれないもののみ抜き出した写像
   例) {1|->'a',
        2|->'b',
        3|->'c'} :-> {'a','b'}
   結果) {3|->'c}


m1 munion m2
   m1 と m2 に含まれる関連づけを両方含む写像
   （同じキーに違う値が結びつけられていない必要がある）
   例) {1|->'a',2|->'b'} munion {1|->'a',3|->'c'}
   結果) {1|->'a',
          2|->'b',
          3|->'c'}
m1 ++ m2
   m1 を m2 に含まれる関連づけで上書きする
   例) {1|->'a',2|->'b'} ++ {1|->'x',3|->'c'}
   結果) {1|->'x',
          2|->'b',
          3|->'c'}
merge ms
   写像の集合 ms に含まれるすべての写像を munion により結合
   例) merge {{1|->'a',2|->'b'},
              {1|->'a',3|->'c'},
              {2|->'b',4|->'d'}}
   結果) {1|->'a',
          2|->'b',
          3|->'c',
          4|->'d'}
m1 comp m2
   map A to B である m2 と map B to C である m1 を合成し，map A to C を作成
   例) {1|->'a',2|->'b'} comp {'x'|->1,'y'|->2}
   結果) {'x'|->'a', 'y'|->'b'}
```
