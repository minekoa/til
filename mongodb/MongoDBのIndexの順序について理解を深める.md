# MongoDB の Indexの順序について理解を深める

順序関係あるんだっけ問題

[MongoDB インデックス概要 | Qiita](https://qiita.com/monoqlock/items/ef6eef43e763c60b9fd2)

> 単一フィールドのインデックスでは昇順/降順どちらの方向でもインデック
> スを使うことができる為、昇順/降順どちらで作成するかはどちらでも変わ
> りありません

ほほー。

> このインデックスでは、フィールドの定義順が重要です。
>
> 例えば{userid: 1, score: -1 }のようなインデックスを定義した場合、ド
> キュメントはまずuseridフィールドでソートされ、次にscoreフィールドで
> ソートされます。

なる。

> インデックスが適用されるのは、全てのインデックスフィールドが指定され
> たクエリと、インデックスフィールドが先頭から一部だけ指定されたクエリ
> です

どゆこと？

`{name: 1 , age: -1, someone: 1 }`

でインデックスつくってると

`{name: 1 , age: 1}`

でクエリ投げてもインデックスが利用されるよ、かな。

> また、このインデックスでは各フィールドが昇順/降順であるかも重要です。
>
> 例えば{ "username" : 1, "date" : -1 }のような複合インデックスを定義
> した場合は、以下のクエリに対してはインデックスが適用されますが
>
> ```
> db.events.find().sort( { username: 1, date: -1 } )
> db.events.find().sort( { username: -1, date: 1 } )
> ```
>
> 以下のクエリではインデックスは使用されません。
>
> ```
> db.events.find().sort( { username: 1, date: 1 } )
> ```

だいたいわかった。

## シャーディング

そもそもシャーディングとは

http://d.hatena.ne.jp/abcb2/20111010/1318224266

> DB shardingは単一のサーバでの処理能力が著しく落ちない程度にデータの
> 大きさを調節する(データベースサイズをスケールする)ことでDBの性能を最
> 大限に引き出せるようにする手法です。MySQLのSpiderエンジンは手軽にDB
> を分散処理できるようにしてくれています。

> これに対してレプリケーションはDBへの参照問い合わせをスケールしてくれ
> ていると言えるでしょう


mongoDBのハッシュシャーディング

https://docs.mongodb.com/manual/core/hashed-sharding/#sharding-hashed-sharding


## まとめ

* インデックス
    * ..の種類
        * 単一キーインデックス
        * 複合インデックス
        * マルチキーインデックス
        * 地理空間インデックス
            - 平面図形向けの2dインデックス
            - 球体図形向けの2dsphereインデックス
        * テキストインデックス .. for 文字列検索
        * ハッシュインデックス .. for ハッシュベースチャーディング
    * ..のプロパティ
        * ユニークインデックス
        * 部分インデックス     ..条件式を満たすドキュメントのみ
        * スパースインデックス ..フィールドに値が存在するドキュメントのみ
        * TTLインデックス      .. 一定の時間が経過したドキュメントを自動的に削除する特殊なインデックス
    * ..の使用
