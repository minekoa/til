# SSD 選定評価レビュー

## シート random

#### 指摘

* [i] このシートは既存のテスト項目っぽいのでレビューを行いませんでした。

## シート SSD

#### 指摘

* [i] このシートはシート SSD(2)のオールドバージョンに見えます。よってレビューを行いませんでした。


## シート SSD(2)


### SSDlee01

* 起動時間確認（劣化前）

#### 試験表（引用）

検証項目チェック
: 1

検証項目名
: 起動時間チェック

パターン/前提条件
: 最初期 3回

備考
: 1日目 30分

#### 指摘

* [?] SSD(3) シートのテスト内容との関係がわかりません（同じテストが書いてあるように見えます）


### SSDlee02

* 起動時間確認（劣化後）

#### 試験表（引用）

検証項目チェック
: 7	

検証項目名
: 負荷試験後 3回

備考
: 3日目 30分	

#### 指摘

* [?] SSD(3) シートのテスト内容との関係がわかりません（同じテストが書いてあるように見えます）

### SSDlee03

* UX確認（負荷環境下）

#### 試験表（引用）

実施項目チェック
: 最後

検証項目名
: 負荷テストでUX確認

パターン/前提条件
: KSL:
: スレッド数最大: 512
: DIOアクセス: 1ms毎
: 共有メモリ: 0.5ms毎 手先位置取得
: シナリオログ書出: 1ms毎 128byte(日本語)
: 
: 外部:
: DIOアクセス: 
: 共有メモリ: 0.5ms毎 手先位置取得、24byte書出
: WebAPI: シナリオ編集
: 
: ログが正しくでていること

検証手順
: UI反応の遅延 画面の初回表示
: 共有メモリの遅延　<-ログから
: WebAPI応答遅延 <-ログから"

備考
: 1日目1時間

#### 指摘

* [!] 確認方法が不明です。
  * 評価基準とするなら、数値が得られるような方法が必要です
  * 一つ一つだと計測不能なくらいのレイテンシしかないのであれば、なるべく早く連続したボタン操作（画面を切り替え続けるなど）して、その連続回数でわるなど
    * ただし、初回の画面表示以外はSSDが要因が現れないので意味がないかもしれません
  * 最低限、なぜか大きな遅れがでたりしていないか？くらいの確認であるならば、確認方法にもその目的を書いてください
* [?] 負荷をかける必要があるかが不明です
  * SSDの負荷が高い状態でレイテンシが大きくならないか、表示がもたつかないかは、確かに見たいですが、そのような環境下では、SSD以外の要因で起きてそうです
  * 負荷のない状態でのレイテンシもみて、ついでにダメ元でみるくらいになるのでしょうか？

### SSDlee04

* 長時間負荷テスト1

#### 試験表（引用）

実施項目チェック
: 3

検証項目名
: 長時間負荷テスト1

パターン/前提条件
: KSL:
: スレッド数最大: 512
: DIOアクセス: 1ms毎
: 共有メモリ: 0.5ms毎 手先位置取得
: シナリオログ書出: 1ms毎 128byte(日本語)
: 
: 外部:
: DIOアクセス: 
: 共有メモリ: 0.5ms毎 手先位置取得、24byte書出
: WebAPI: シナリオ編集

検証手順
: ksl実行遅延をみる

確認内容
: ・ログ1byte書いて終了する。これの繰り返し。
: 
: ・
: ・

備考
: 1日目 6時間

#### 指摘

* [?] SSD(3) シートのテスト内容との関係がわかりません（同じテストが書いてあるように見えます）
* [!] テストの項目名、検証手順、確認内容、がちぐはぐです
  * もし「長時間負荷テスト１」であるならば、検証手順「KSL実行遅延を見る」はマッチしません
  * もし「KSL実行遅延を見る」であるならば、確認内容「ログ1byte書いて終了する。これの繰り返し」はマッチしません

### SSDlee05

* 電源瞬断テスト

#### 試験表（引用）

実施項目チェック
: 5

検証項目名
: 電源瞬断

パターン/前提条件
: 負荷テスト実施中、ログ圧縮中に 電源瞬断

確認内容
: 書き込み中の瞬断
: 動かないlongrun
: 共有メモリ: 10ms

備考
: 2日目 30分

#### 指摘

* [?] 「負荷テスト実施中」と「ログ圧縮中」それぞれに対して行うのですか？
* [!] 瞬断の実施方法を検討してください
  * 電源長おし？コンセントぶっこ抜き？
  * コンセントぶっこ抜きが大丈夫かは、カセヤマさんがイイダさんに問い合わせ中です（たしか）


### SSDlee06?

検証項目名
: 再起動1800回

#### 指摘

* [!] 内容がなさすぎて意味不明です..


### ler01

* update.sh の機能試験
* 機能を満たしていないことが後で発覚した際に、後続のテストを無駄にしないため

#### 試験表（引用）

実施項目チェック
: 1

検証項目名
: ラーで upだて.sh

検証手順
: "update.shでleeの書き込みができること。
:
: 焼き込み後、RED起動・動作確認sda sdb のサイズ、権限の確認
: controllerlog.scenariolog が出ていること

備考
: 30分

### ler02

* update.sh の SSD評価


#### 試験表（引用）

実施項目チェック
: 2		

検証項目名
: ラーで upだて.sh	

パターン/前提条件
: 16回?

検証手順
: setup.sh を16回実施。時間を計測 update.shの前後でsmart情報も

確認内容
: ler 起動 -> update.sh -> RED起動 ->ler再起動… 繰り返し

備考
: 5.5時間

#### 指摘

* [?] 24日の議論の結果、RED起動後のSMART取得はとるんでしたっけ, やめたんでしたっけ


### ler03

* update.sh (回数をたくさん)

#### 試験表（引用）

実施項目チェック
: 3		

検証項目名
: ラーで upだて.sh	

パターン/前提条件
: ひたすら回数を。				


#### 指摘

* [?] この試験はなんのために必要なんでしたっけ？

### ler04

* setup.sh?

#### 試験表（引用）

実施項目チェック
: 5		

検証項目名
: ラーで upset.sh

検証手順
: setup.shでleeの抜き出しができること。

確認内容
: ler 起動 -> update.sh -> RED起動 ->ler再起動… 繰り返し

: 2日目 30分

#### 指摘

* [!] 検証項目名と確認内容がupdate.sh のままの表記になっています
* [!] 検証手順が「setup.shでleeの抜き出しができること」となっていますが、どういうこと？
* コピペで編集途中で放置された感じです..

### ler05

* upset.sh

#### 試験表（引用）

実施項目チェック
: 4		

検証項目名
: ラーで upset.sh	

パターン/前提条件
: ??回

検証手順
: 時間を計測

備考
: ???


## シート SSD(3)

### REDSSD01

* 起動時間の計測（劣化前）
* 目的は、起動時間が仕様内に収まっているか

#### 試験表（引用）

検証項目名
: 起動時計測

検証開始画面
: 電源OFF

検証手順
: 1. 電源を投入し、同時にストップウォッチ計測を開始する
: 2. アーム操作画面が出るタイミングで、ストップウォッチ計測をやめ、計測時間を記録する
: 3. 電源を切る
: 4. 手順1~3を10回繰り返す

確認内容
: 1: XX秒
: 2: XX秒
: 3: XX秒
: 4: XX秒
: 5: XX秒
: 6: XX秒
: 7: XX秒
: 8: XX秒
: 9: XX秒
: 10: XX秒
: 
: 平均: XX秒

#### 指摘

* [?] 10回の平均なのはなぜ (10回である理由(十分なのか？もっと減らせないか？など)/平均である理由(最大でなくてよいの？))
* [!] 仕様としての起動時間との比較はしないの？


### REDSSD02

#### 試験表（引用）

検証項目名
: 機能テスト

検証開始氏画面
: 電源OFF

検証手順
: 1. 電源を投入し、アーム操作画面が出るまで待つ
: 2. REDfn の必須項目を実施する

確認内容
: 2. 全項目が合格となる

#### 指摘

> REFfn の必須項目を実施する

* [!] 「REFfn の必須項目を実施」には、半日程度の時間が必要と聞きました。正しくインストール出来ているかの確認（あとで手戻りしないため）としては、半日かかるテストを実施するのは重すぎます。もっと軽い試験ができるのではないか
  * 3/24 午前中のレビューで指摘された項目でいいと思います

### (漏れ項目)

#### 指摘

* [!] 最大負荷とはどういうパラメータなのかを求めるための評価が必要です
  * 求め方も手順であるため、評価手順にまとめてください

(https://dev.liferobotics.jp/redmine/issues/11589) のコメント#5 

> * 負荷をあげる方法、継続して試験する為に必要な設定の見極め
>   * 圧縮にかかる時間が長すぎると、ファイルの削除が間に合わず、ニッチモになってしまう。ローテーションのサイズを調整する必要があるかもしれない
>   * シナリオの中では move命令をグルグル回す + シナリオログ出力をグルグル回す の２スレッドくらい
>     * １回のログに書き出すサイズは調整が必要（１B？ページサイズ？セクタサイズ？）
>   * sharedメモリでガンガンかける必要がある（状態ポーリング）
>   * SSD毎に負荷のかけかたを変えるのか？どう決定するのか？
> * 負荷の具合の見方
>   * 定常状態に入るまで待ってから、N分毎にTBW等をダンプ
> * まずはやってみて、加速試験するかどうか、どう行うのかを検討してみては？

や コメント#11を参照してください

> * まずは controllerろぐをガンガンかきだして
>   * rotatelogsのサイズはニッチモがおきない いい感じのパラメーターになる 2分探索とか

### REDSSD03

* 最大負荷環境下で、SSDがどのように劣化していくかを確認する
* 指摘にも入れたが「最大負荷試験」の意味するものは、負荷パラメータの調査で有望そうなものとする

#### 試験表（引用）

検証項目名
: 最大負荷試験

検証手順
: 1. 最大負荷試験をひたすら実施する
: 2. ○min毎にSMARTを取得する

備考
: ロボットは動かない
: KSL内:
: スレッド数最大: 512
: 共有メモリ: 1スレッドでひたすらアクセス
: WebAPI: ひたすらログダウンロード
: シナリオログ: 1スレッドでひたすら1byte書き込み
:
: 外部から:
: 共有メモリ: 0.5ms毎 手先位置取得、24byte書出
: WebAPI: ひたすらログダウンロード

メモ
: 標準最大負荷の加速扱いするかも


#### 指摘

* [!] 最大負荷とはどういうパラメータなのかを求めるための評価が必要です
  * 求め方も手順であるため、評価手順にまとめてください
  * (それにしても「ひたすら」というのはちょっとひどいのでは？)
* [?] SMARTの取得インターバルはどうしましょう 
  * 「標準負荷の加速試験」とするならば、1加速日 を意識したインターバルとしたいです

想定最大負荷は、

> REDで最もSSDに負荷をかける読み出し・書き込みを行った場合の負荷（共有メモリアクセス、WebAPI、DIO、KSLスレッド最大数実行）
> "既存の負荷試験で発生するコントローラーログへの書き込みは500KB/sec程度
> （erlangログやシステムのログを考えると倍程度の負荷がSSDにかかる想定)"

だそうです。

(https://dev.liferobotics.jp/redmine/issues/11589) のコメント#11 も見てください

> * 最大負荷のかけかたは？
>   * state 状態のpolling はなるたけ
>   * ログ１バイトだけ書き込むシナリオグルグル vs 動かし続ける（１，ページ、セクタ）
>   * webAPI アップロードあり/なし
>   * どれくらいかければ smart の傾向を読むのに適したデータになる??
>     * 分からない。線形性見えた段階で終わらせる？ -> スペアブロックの数が気になる
>     * 1週目は効率よさそう。2週目、３週目の傾向から妥当かどうか判断できるかも

### REDSSD04

#### 試験表（引用）

検証項目名
: 標準負荷試験

検証手順
: 1. 標準負荷試験を行う。
: 実施中に...
: * ゆっくり負荷で、○min毎に再起動を○回実施。
: * 再起動35回に1回は電源長押しでの電源断 -> 電源入
: * その後、○min毎に瞬断を○回実施。
: 2. 再起動前後で SMARTを取得する。

備考
: ロボットが動かないlongrun
: (ログ出す, move->時間・回数・エラー値,6秒に1回)
:
: 共有メモリ: 10ms
: WebAPI: ひたすらログダウンロード

#### 指摘

(https://dev.liferobotics.jp/redmine/issues/11589) のコメント#11 を見てください

> * ニセモノ標準ロングラン（同じ位置のmove） ログは吐く　エラー値など を move の後に 出す
> * polling は 10msくらいで それ以上は意味がないので
> * webAPIはダウンロード 1回再生したら一回終わる -> 終わらない -> 6秒に一回
> * これでTBWの増え具合を見る 5年分測る
> * 再起動は間にはさまる
> * 標準負荷の瞬断は最後
> * 加速はどうするの？最大負荷でやる。


### (漏れ項目?)

#### 指摘

* 標準負荷試験（with 電源瞬断）を追加してください
* シートSSD に電源瞬断テストが書かれていますので、漏れではないのかもしれませんが、シートSSD(3) との関連がよくわからないので、念の為指摘します


### (漏れ項目)

#### 指摘

> 全部とおったあとに dev/zero とかで rotatelog くわせて、TBWになるまでどうなるか調べる

を実施してください。

(https://dev.liferobotics.jp/redmine/issues/11589) のコメント#11 を見てください


### REDSSD05

* 起動時間の計測（劣化後）
* 目的は、起動時間が仕様内に収まっているか

#### 試験表（引用）

検証項目名
: 起動時間計測

検証開始前画面
: 電源OFF

検証手順
: 1. 電源を投入し、同時にストップウォッチ計測を開始する。
: 2. アーム操作画面が出るタイミングで、ストップウォッチ計測を止め、経過時間を記録する。
: 3. 電源を切る。
: 4. 手順1～3を10回繰り返す。

確認内容
: 1: XX秒
: 2: XX秒
: 3: XX秒
: 4: XX秒
: 5: XX秒
: 6: XX秒
: 7: XX秒
: 8: XX秒
: 9: XX秒
: 10: XX秒
: 
: 平均: XX秒

#### 指摘

* [!] REDSSD01 と指摘内容は同じです


### REDSSD06

#### 試験表（引用）

検証項目名
: 機能テスト

検証開始前画面
: 電源OFF

検証手順
: 1. 電源を投入し、アーム操作画面が出るまで待つ。
: 2. REDfn の　必須項目を実施する。

確認内容
: 2. 全項目が合格となる。

#### 指摘

* [?]この試験、必要ですか？

