# カラムナDB

[ClickHouse](https://clickhouse.yandex/) をしらべてて。


[MySQLを捨てClickHouseでレポートAPIのレスポンスを1000倍高速化した話](https://tech.geniee.co.jp/entry/2017/07/20/160100)

> ## TL;DR
>
> * ClickHouseで分析系クエリが1000倍の速度に爆速化
> * DBの容量もMySQLと比べ1/13に軽量化
> * ClickHouse導入はMySQLには無い制限もあるけど、なんとかなる
> * あんまり日本での導入事例が見当たら無いけど、クエリの高速化・DBの軽量化したい人はぜひ使うといいことがあるかもしれません

このChilckHouse の持つ「分析計クエリがメタクソ早い」「DBを容量もひと桁少なくてすむ」とうい性質は
カラムナDBの持つ性質らしい.カラムナDBとは

[列指向データベース管理システム](https://ja.wikipedia.org/wiki/%E5%88%97%E6%8C%87%E5%90%91%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E7%AE%A1%E7%90%86%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0)

> 通常のDBMSシステムはひとつの行を構成する列データをひとまとまりとして
> 格納する。これに対し列指向DBMSでは、列の値をまとめてファイルシステム
> 上の近い場所に（あるいはひとまとまりの論理構造として）置くというアプ
> ローチがある

なぜそのようなメリットがでるのか。

[カラム型データベースはなぜ集計処理が高速で、トランザクションが苦手なのか。インメモリとカラム型データベースの可能性を調べる（その4）](https://www.publickey1.jp/blog/13/4_1.html)

> カラム型データベースは列指向で処理を行います。列方向にデータをまとめ
> て保存しており、列方向に読み込んで処理するため、列方向の処理に非常に
> 長けています。
>
> 在庫の価格を全部足し合わせる集計処理では、在庫データから価格の列だけ
> を読み込んでまとめて足し算できるため、それ以外の列のデータを処理する
> 必要がありません。そのため、行指向のデータベースに比べると非常に短時
> 間で処理できます。
>
> カラム型データベースでは、データ圧縮の効率が高いというもう1つの特徴
> があります。 列方向のデータは同一のデータ型であり、しかも住所や氏名、
> 価格など特定の種類のデータが並んでいるため、ばらつきが小さく同じ値が
> 繰り返し表れることも多いため、圧縮効率が非常によいのです。
>
> 列方向へのデータ圧縮は、列指向の処理をさらに高速にします。ある列を10
> 分の1に圧縮できたのならば、その列を読み込む時間も10分の1になるからで
> す。カラム型データベースとデータ圧縮は、セットで実装されているのが一
> 般的です

ただ、データの追加、削除、更新が苦手

> データを1件追加することを考えましょう。データ1件には商品名と価格と個
> 数の列が含まれているとします。従来の行指向のデータベースなら1行の追
> 加が1回の処理で済みます。ところがカラム型データベースは列方向にデー
> タが保存されており、列方向にデータを操作するので、この1件を追加する
> のには商品名の列を読み込んでデータを追加、価格の列を読み込んでデータ
> を追加、そして個数の列を読み込んでデータを追加と、追加処理が3回走り
> ます。
>
> しかもデータベースが列ごとに圧縮されているとすれば、列ごとに圧縮デー
> タを展開し、データを追加。そして再び圧縮しなくてはなりません。データ
> の削除や更新でも同じことです。
>
> いかにインメモリデータベースが高速だとしても、カラム型データベースで
> データの追加更新削除などの処理は、そのままでは非常に遅くなってしまう
> 構造になっているのです。
>
> これが、カラム型データベースの集計や分析処理が高速な理由、そして追加
> 更新削除を含むトランザクション処理が苦手な理由です。


## その他リンク

* [データウェアハウス ClickHouse を使ってみた話。](https://tech.basicinc.jp/articles/137)
